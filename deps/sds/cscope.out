cscope 15 /opt/workspace/fsm/deps/sds -q 0000000213 0000027602
	@sds.c

33 
	~<¡dio.h
>

34 
	~<¡dlib.h
>

35 
	~<¡ršg.h
>

36 
	~<ùy³.h
>

37 
	~<as£¹.h
>

38 
	~<lim™s.h
>

39 
	~"sds.h
"

42 
šlše
 
	$sdsHdrSize
(
ty³
) {

43 
ty³
&
SDS_TYPE_MASK
) {

44 
SDS_TYPE_5
:

45  (
sdshdr5
);

46 
SDS_TYPE_8
:

47  (
sdshdr8
);

48 
SDS_TYPE_16
:

49  (
sdshdr16
);

50 
SDS_TYPE_32
:

51  (
sdshdr32
);

52 
SDS_TYPE_64
:

53  (
sdshdr64
);

56 
	}
}

58 
šlše
 
	$sdsReqTy³
(
size_t
 
¡ršg_size
) {

59 ià(
¡ršg_size
 < 1<<5)

60  
SDS_TYPE_5
;

61 ià(
¡ršg_size
 < 1<<8)

62  
SDS_TYPE_8
;

63 ià(
¡ršg_size
 < 1<<16)

64  
SDS_TYPE_16
;

65 #ià(
LONG_MAX
 =ğ
LLONG_MAX
)

66 ià(
¡ršg_size
 < 1ll<<32)

67  
SDS_TYPE_32
;

69  
SDS_TYPE_64
;

70 
	}
}

84 
sds
 
	$sd¢ewËn
(cÚ¡ *
š™
, 
size_t
 
š™Ën
) {

85 *
sh
;

86 
sds
 
s
;

87 
ty³
 = 
	`sdsReqTy³
(
š™Ën
);

90 ià(
ty³
 =ğ
SDS_TYPE_5
 && 
š™Ën
 =ğ0èty³ = 
SDS_TYPE_8
;

91 
hd¾’
 = 
	`sdsHdrSize
(
ty³
);

92 *
å
;

94 
sh
 = 
	`s_m®loc
(
hd¾’
+
š™Ën
+1);

95 ià(!
š™
)

96 
	`mem£t
(
sh
, 0, 
hd¾’
+
š™Ën
+1);

97 ià(
sh
 =ğ
NULL
)  NULL;

98 
s
 = (*)
sh
+
hd¾’
;

99 
å
 = ((*)
s
)-1;

100 
ty³
) {

101 
SDS_TYPE_5
: {

102 *
å
 = 
ty³
 | (
š™Ën
 << 
SDS_TYPE_BITS
);

105 
SDS_TYPE_8
: {

106 
	`SDS_HDR_VAR
(8,
s
);

107 
sh
->
Ën
 = 
š™Ën
;

108 
sh
->
®loc
 = 
š™Ën
;

109 *
å
 = 
ty³
;

112 
SDS_TYPE_16
: {

113 
	`SDS_HDR_VAR
(16,
s
);

114 
sh
->
Ën
 = 
š™Ën
;

115 
sh
->
®loc
 = 
š™Ën
;

116 *
å
 = 
ty³
;

119 
SDS_TYPE_32
: {

120 
	`SDS_HDR_VAR
(32,
s
);

121 
sh
->
Ën
 = 
š™Ën
;

122 
sh
->
®loc
 = 
š™Ën
;

123 *
å
 = 
ty³
;

126 
SDS_TYPE_64
: {

127 
	`SDS_HDR_VAR
(64,
s
);

128 
sh
->
Ën
 = 
š™Ën
;

129 
sh
->
®loc
 = 
š™Ën
;

130 *
å
 = 
ty³
;

134 ià(
š™Ën
 && 
š™
)

135 
	`memıy
(
s
, 
š™
, 
š™Ën
);

136 
s
[
š™Ën
] = '\0';

137  
s
;

138 
	}
}

142 
sds
 
	$sd£m±y
() {

143  
	`sd¢ewËn
("",0);

144 
	}
}

147 
sds
 
	$sd¢ew
(cÚ¡ *
š™
) {

148 
size_t
 
š™Ën
 = (
š™
 =ğ
NULL
è? 0 : 
	`¡¾’
(init);

149  
	`sd¢ewËn
(
š™
, 
š™Ën
);

150 
	}
}

153 
sds
 
	$sdsdup
(cÚ¡ 
sds
 
s
) {

154  
	`sd¢ewËn
(
s
, 
	`sd¦’
(s));

155 
	}
}

158 
	$sdsä“
(
sds
 
s
) {

159 ià(
s
 =ğ
NULL
) ;

160 
	`s_ä“
((*)
s
-
	`sdsHdrSize
(s[-1]));

161 
	}
}

177 
	$sdsupd©–’
(
sds
 
s
) {

178 
»®Ën
 = 
	`¡¾’
(
s
);

179 
	`sds£’
(
s
, 
»®Ën
);

180 
	}
}

186 
	$sdsş—r
(
sds
 
s
) {

187 
	`sds£’
(
s
, 0);

188 
s
[0] = '\0';

189 
	}
}

197 
sds
 
	$sdsMakeRoomFÜ
(
sds
 
s
, 
size_t
 
addËn
) {

198 *
sh
, *
Ãwsh
;

199 
size_t
 
ava
 = 
	`sd§va
(
s
);

200 
size_t
 
Ën
, 
ÃwËn
;

201 
ty³
, 
Şdty³
 = 
s
[-1] & 
SDS_TYPE_MASK
;

202 
hd¾’
;

205 ià(
ava
 >ğ
addËn
è 
s
;

207 
Ën
 = 
	`sd¦’
(
s
);

208 
sh
 = (*)
s
-
	`sdsHdrSize
(
Şdty³
);

209 
ÃwËn
 = (
Ën
+
addËn
);

210 ià(
ÃwËn
 < 
SDS_MAX_PREALLOC
)

211 
ÃwËn
 *= 2;

213 
ÃwËn
 +ğ
SDS_MAX_PREALLOC
;

215 
ty³
 = 
	`sdsReqTy³
(
ÃwËn
);

220 ià(
ty³
 =ğ
SDS_TYPE_5
èty³ = 
SDS_TYPE_8
;

222 
hd¾’
 = 
	`sdsHdrSize
(
ty³
);

223 ià(
Şdty³
==
ty³
) {

224 
Ãwsh
 = 
	`s_»®loc
(
sh
, 
hd¾’
+
ÃwËn
+1);

225 ià(
Ãwsh
 =ğ
NULL
)  NULL;

226 
s
 = (*)
Ãwsh
+
hd¾’
;

230 
Ãwsh
 = 
	`s_m®loc
(
hd¾’
+
ÃwËn
+1);

231 ià(
Ãwsh
 =ğ
NULL
)  NULL;

232 
	`memıy
((*)
Ãwsh
+
hd¾’
, 
s
, 
Ën
+1);

233 
	`s_ä“
(
sh
);

234 
s
 = (*)
Ãwsh
+
hd¾’
;

235 
s
[-1] = 
ty³
;

236 
	`sds£’
(
s
, 
Ën
);

238 
	`sds£Îoc
(
s
, 
ÃwËn
);

239  
s
;

240 
	}
}

248 
sds
 
	$sdsRemoveF»eS·û
(
sds
 
s
) {

249 *
sh
, *
Ãwsh
;

250 
ty³
, 
Şdty³
 = 
s
[-1] & 
SDS_TYPE_MASK
;

251 
hd¾’
;

252 
size_t
 
Ën
 = 
	`sd¦’
(
s
);

253 
sh
 = (*)
s
-
	`sdsHdrSize
(
Şdty³
);

255 
ty³
 = 
	`sdsReqTy³
(
Ën
);

256 
hd¾’
 = 
	`sdsHdrSize
(
ty³
);

257 ià(
Şdty³
==
ty³
) {

258 
Ãwsh
 = 
	`s_»®loc
(
sh
, 
hd¾’
+
Ën
+1);

259 ià(
Ãwsh
 =ğ
NULL
)  NULL;

260 
s
 = (*)
Ãwsh
+
hd¾’
;

262 
Ãwsh
 = 
	`s_m®loc
(
hd¾’
+
Ën
+1);

263 ià(
Ãwsh
 =ğ
NULL
)  NULL;

264 
	`memıy
((*)
Ãwsh
+
hd¾’
, 
s
, 
Ën
+1);

265 
	`s_ä“
(
sh
);

266 
s
 = (*)
Ãwsh
+
hd¾’
;

267 
s
[-1] = 
ty³
;

268 
	`sds£’
(
s
, 
Ën
);

270 
	`sds£Îoc
(
s
, 
Ën
);

271  
s
;

272 
	}
}

281 
size_t
 
	$sdsAÎocSize
(
sds
 
s
) {

282 
size_t
 
®loc
 = 
	`sd§Îoc
(
s
);

283  
	`sdsHdrSize
(
s
[-1])+
®loc
+1;

284 
	}
}

288 *
	$sdsAÎocPŒ
(
sds
 
s
) {

289  (*è(
s
-
	`sdsHdrSize
(s[-1]));

290 
	}
}

315 
	$sdsInüL’
(
sds
 
s
, 
šü
) {

316 
æags
 = 
s
[-1];

317 
size_t
 
Ën
;

318 
æags
&
SDS_TYPE_MASK
) {

319 
SDS_TYPE_5
: {

320 *
å
 = ((*)
s
)-1;

321 
ŞdËn
 = 
	`SDS_TYPE_5_LEN
(
æags
);

322 
	`as£¹
((
šü
 > 0 && 
ŞdËn
+incr < 32) || (incr < 0 && oldlen >= ()(-incr)));

323 *
å
 = 
SDS_TYPE_5
 | ((
ŞdËn
+
šü
è<< 
SDS_TYPE_BITS
);

324 
Ën
 = 
ŞdËn
+
šü
;

327 
SDS_TYPE_8
: {

328 
	`SDS_HDR_VAR
(8,
s
);

329 
	`as£¹
((
šü
 >ğ0 && 
sh
->
®loc
-sh->
Ën
 >= incr) || (incr < 0 && sh->len >= ()(-incr)));

330 
Ën
 = (
sh
->ËÀ+ğ
šü
);

333 
SDS_TYPE_16
: {

334 
	`SDS_HDR_VAR
(16,
s
);

335 
	`as£¹
((
šü
 >ğ0 && 
sh
->
®loc
-sh->
Ën
 >= incr) || (incr < 0 && sh->len >= ()(-incr)));

336 
Ën
 = (
sh
->ËÀ+ğ
šü
);

339 
SDS_TYPE_32
: {

340 
	`SDS_HDR_VAR
(32,
s
);

341 
	`as£¹
((
šü
 >ğ0 && 
sh
->
®loc
-sh->
Ën
 >= ()incr) || (incr < 0 && sh->len >= ()(-incr)));

342 
Ën
 = (
sh
->ËÀ+ğ
šü
);

345 
SDS_TYPE_64
: {

346 
	`SDS_HDR_VAR
(64,
s
);

347 
	`as£¹
((
šü
 >ğ0 && 
sh
->
®loc
-sh->
Ën
 >ğ(
ušt64_t
)incr) || (incr < 0 && sh->len >= (uint64_t)(-incr)));

348 
Ën
 = (
sh
->ËÀ+ğ
šü
);

351 : 
Ën
 = 0;

353 
s
[
Ën
] = '\0';

354 
	}
}

361 
sds
 
	$sdsgrowz”o
(
sds
 
s
, 
size_t
 
Ën
) {

362 
size_t
 
cu¾’
 = 
	`sd¦’
(
s
);

364 ià(
Ën
 <ğ
cu¾’
è 
s
;

365 
s
 = 
	`sdsMakeRoomFÜ
(s,
Ën
-
cu¾’
);

366 ià(
s
 =ğ
NULL
)  NULL;

369 
	`mem£t
(
s
+
cu¾’
,0,(
Ën
-curlen+1));

370 
	`sds£’
(
s
, 
Ën
);

371  
s
;

372 
	}
}

379 
sds
 
	$sdsÿ’
(
sds
 
s
, cÚ¡ *
t
, 
size_t
 
Ën
) {

380 
size_t
 
cu¾’
 = 
	`sd¦’
(
s
);

382 
s
 = 
	`sdsMakeRoomFÜ
(s,
Ën
);

383 ià(
s
 =ğ
NULL
)  NULL;

384 
	`memıy
(
s
+
cu¾’
, 
t
, 
Ën
);

385 
	`sds£’
(
s
, 
cu¾’
+
Ën
);

386 
s
[
cu¾’
+
Ën
] = '\0';

387  
s
;

388 
	}
}

394 
sds
 
	$sdsÿt
(
sds
 
s
, cÚ¡ *
t
) {

395  
	`sdsÿ’
(
s
, 
t
, 
	`¡¾’
(t));

396 
	}
}

402 
sds
 
	$sdsÿtsds
(
sds
 
s
, cÚ¡ sd 
t
) {

403  
	`sdsÿ’
(
s
, 
t
, 
	`sd¦’
(t));

404 
	}
}

408 
sds
 
	$sdsıyËn
(
sds
 
s
, cÚ¡ *
t
, 
size_t
 
Ën
) {

409 ià(
	`sd§Îoc
(
s
è< 
Ën
) {

410 
s
 = 
	`sdsMakeRoomFÜ
(s,
Ën
-
	`sd¦’
(s));

411 ià(
s
 =ğ
NULL
)  NULL;

413 
	`memıy
(
s
, 
t
, 
Ën
);

414 
s
[
Ën
] = '\0';

415 
	`sds£’
(
s
, 
Ën
);

416  
s
;

417 
	}
}

421 
sds
 
	$sdsıy
(
sds
 
s
, cÚ¡ *
t
) {

422  
	`sdsıyËn
(
s
, 
t
, 
	`¡¾’
(t));

423 
	}
}

431 
	#SDS_LLSTR_SIZE
 21

	)

432 
	$sd¦l2¡r
(*
s
, 
v®ue
) {

433 *
p
, 
aux
;

434 
v
;

435 
size_t
 
l
;

439 
v
 = (
v®ue
 < 0) ? -value : value;

440 
p
 = 
s
;

442 *
p
++ = '0'+(
v
%10);

443 
v
 /= 10;

444 } 
v
);

445 ià(
v®ue
 < 0è*
p
++ = '-';

448 
l
 = 
p
-
s
;

449 *
p
 = '\0';

452 
p
--;

453 
s
 < 
p
) {

454 
aux
 = *
s
;

455 *
s
 = *
p
;

456 *
p
 = 
aux
;

457 
s
++;

458 
p
--;

460  
l
;

461 
	}
}

464 
	$sdsuÎ2¡r
(*
s
, 
v
) {

465 *
p
, 
aux
;

466 
size_t
 
l
;

470 
p
 = 
s
;

472 *
p
++ = '0'+(
v
%10);

473 
v
 /= 10;

474 } 
v
);

477 
l
 = 
p
-
s
;

478 *
p
 = '\0';

481 
p
--;

482 
s
 < 
p
) {

483 
aux
 = *
s
;

484 *
s
 = *
p
;

485 *
p
 = 
aux
;

486 
s
++;

487 
p
--;

489  
l
;

490 
	}
}

496 
sds
 
	$sdsäomlÚglÚg
(
v®ue
) {

497 
buf
[
SDS_LLSTR_SIZE
];

498 
Ën
 = 
	`sd¦l2¡r
(
buf
,
v®ue
);

500  
	`sd¢ewËn
(
buf
,
Ën
);

501 
	}
}

504 
sds
 
	$sdsÿtv´štf
(
sds
 
s
, cÚ¡ *
fmt
, 
va_li¡
 
­
) {

505 
va_li¡
 
ıy
;

506 
¡©icbuf
[1024], *
buf
 = sticbuf, *
t
;

507 
size_t
 
buæ’
 = 
	`¡¾’
(
fmt
)*2;

511 ià(
buæ’
 > (
¡©icbuf
)) {

512 
buf
 = 
	`s_m®loc
(
buæ’
);

513 ià(
buf
 =ğ
NULL
)  NULL;

515 
buæ’
 = (
¡©icbuf
);

521 
buf
[
buæ’
-2] = '\0';

522 
	`va_cİy
(
ıy
,
­
);

523 
	`v¢´štf
(
buf
, 
buæ’
, 
fmt
, 
ıy
);

524 
	`va_’d
(
ıy
);

525 ià(
buf
[
buæ’
-2] != '\0') {

526 ià(
buf
 !ğ
¡©icbuf
è
	`s_ä“
(buf);

527 
buæ’
 *= 2;

528 
buf
 = 
	`s_m®loc
(
buæ’
);

529 ià(
buf
 =ğ
NULL
)  NULL;

536 
t
 = 
	`sdsÿt
(
s
, 
buf
);

537 ià(
buf
 !ğ
¡©icbuf
è
	`s_ä“
(buf);

538  
t
;

539 
	}
}

557 
sds
 
	$sdsÿrštf
(
sds
 
s
, cÚ¡ *
fmt
, ...) {

558 
va_li¡
 
­
;

559 *
t
;

560 
	`va_¡¬t
(
­
, 
fmt
);

561 
t
 = 
	`sdsÿtv´štf
(
s
,
fmt
,
­
);

562 
	`va_’d
(
­
);

563  
t
;

564 
	}
}

582 
sds
 
	$sdsÿtfmt
(
sds
 
s
, cÚ¡ *
fmt
, ...) {

583 
size_t
 
š™Ën
 = 
	`sd¦’
(
s
);

584 cÚ¡ *
f
 = 
fmt
;

585 
i
;

586 
va_li¡
 
­
;

588 
	`va_¡¬t
(
­
,
fmt
);

589 
f
 = 
fmt
;

590 
i
 = 
š™Ën
;

591 *
f
) {

592 
Ãxt
, *
¡r
;

593 
size_t
 
l
;

594 
num
;

595 
unum
;

598 ià(
	`sd§va
(
s
)==0) {

599 
s
 = 
	`sdsMakeRoomFÜ
(s,1);

602 *
f
) {

604 
Ãxt
 = *(
f
+1);

605 
f
++;

606 
Ãxt
) {

609 
¡r
 = 
	`va_¬g
(
­
,*);

610 
l
 = (
Ãxt
 =ğ's'è? 
	`¡¾’
(
¡r
è: 
	`sd¦’
(str);

611 ià(
	`sd§va
(
s
è< 
l
) {

612 
s
 = 
	`sdsMakeRoomFÜ
(s,
l
);

614 
	`memıy
(
s
+
i
,
¡r
,
l
);

615 
	`sdsšş’
(
s
,
l
);

616 
i
 +ğ
l
;

620 ià(
Ãxt
 == 'i')

621 
num
 = 
	`va_¬g
(
­
,);

623 
num
 = 
	`va_¬g
(
­
,);

625 
buf
[
SDS_LLSTR_SIZE
];

626 
l
 = 
	`sd¦l2¡r
(
buf
,
num
);

627 ià(
	`sd§va
(
s
è< 
l
) {

628 
s
 = 
	`sdsMakeRoomFÜ
(s,
l
);

630 
	`memıy
(
s
+
i
,
buf
,
l
);

631 
	`sdsšş’
(
s
,
l
);

632 
i
 +ğ
l
;

637 ià(
Ãxt
 == 'u')

638 
unum
 = 
	`va_¬g
(
­
,);

640 
unum
 = 
	`va_¬g
(
­
,);

642 
buf
[
SDS_LLSTR_SIZE
];

643 
l
 = 
	`sdsuÎ2¡r
(
buf
,
unum
);

644 ià(
	`sd§va
(
s
è< 
l
) {

645 
s
 = 
	`sdsMakeRoomFÜ
(s,
l
);

647 
	`memıy
(
s
+
i
,
buf
,
l
);

648 
	`sdsšş’
(
s
,
l
);

649 
i
 +ğ
l
;

653 
s
[
i
++] = 
Ãxt
;

654 
	`sdsšş’
(
s
,1);

659 
s
[
i
++] = *
f
;

660 
	`sdsšş’
(
s
,1);

663 
f
++;

665 
	`va_’d
(
­
);

668 
s
[
i
] = '\0';

669  
s
;

670 
	}
}

686 
sds
 
	$sd¡rim
(
sds
 
s
, cÚ¡ *
c£t
) {

687 *
¡¬t
, *
’d
, *
¥
, *
•
;

688 
size_t
 
Ën
;

690 
¥
 = 
¡¬t
 = 
s
;

691 
•
 = 
’d
 = 
s
+
	`sd¦’
(s)-1;

692 
¥
 <ğ
’d
 && 
	`¡rchr
(
c£t
, *sp)) sp++;

693 
•
 > 
¥
 && 
	`¡rchr
(
c£t
, *ep))ƒp--;

694 
Ën
 = (
¥
 > 
•
) ? 0 : ((ep-sp)+1);

695 ià(
s
 !ğ
¥
è
	`memmove
(s, sp, 
Ën
);

696 
s
[
Ën
] = '\0';

697 
	`sds£’
(
s
,
Ën
);

698  
s
;

699 
	}
}

717 
	$sd¤ªge
(
sds
 
s
, 
¡¬t
, 
’d
) {

718 
size_t
 
ÃwËn
, 
Ën
 = 
	`sd¦’
(
s
);

720 ià(
Ën
 == 0) ;

721 ià(
¡¬t
 < 0) {

722 
¡¬t
 = 
Ën
+start;

723 ià(
¡¬t
 < 0) start = 0;

725 ià(
’d
 < 0) {

726 
’d
 = 
Ën
+end;

727 ià(
’d
 < 0)ƒnd = 0;

729 
ÃwËn
 = (
¡¬t
 > 
’d
) ? 0 : (end-start)+1;

730 ià(
ÃwËn
 != 0) {

731 ià(
¡¬t
 >ğ(sigÃd)
Ën
) {

732 
ÃwËn
 = 0;

733 } ià(
’d
 >ğ(sigÃd)
Ën
) {

734 
’d
 = 
Ën
-1;

735 
ÃwËn
 = (
¡¬t
 > 
’d
) ? 0 : (end-start)+1;

738 
¡¬t
 = 0;

740 ià(
¡¬t
 && 
ÃwËn
è
	`memmove
(
s
, s+start,‚ewlen);

741 
s
[
ÃwËn
] = 0;

742 
	`sds£’
(
s
,
ÃwËn
);

743 
	}
}

746 
	$sd¡Şow”
(
sds
 
s
) {

747 
Ën
 = 
	`sd¦’
(
s
), 
j
;

749 
j
 = 0; j < 
Ën
; j++è
s
[j] = 
	`tŞow”
(s[j]);

750 
	}
}

753 
	$sd¡ouµ”
(
sds
 
s
) {

754 
Ën
 = 
	`sd¦’
(
s
), 
j
;

756 
j
 = 0; j < 
Ën
; j++è
s
[j] = 
	`touµ”
(s[j]);

757 
	}
}

770 
	$sdscmp
(cÚ¡ 
sds
 
s1
, cÚ¡ sd 
s2
) {

771 
size_t
 
l1
, 
l2
, 
mšËn
;

772 
cmp
;

774 
l1
 = 
	`sd¦’
(
s1
);

775 
l2
 = 
	`sd¦’
(
s2
);

776 
mšËn
 = (
l1
 < 
l2
) ?†1 :†2;

777 
cmp
 = 
	`memcmp
(
s1
,
s2
,
mšËn
);

778 ià(
cmp
 =ğ0è 
l1
-
l2
;

779  
cmp
;

780 
	}
}

798 
sds
 *
	$sds¥l™Ën
(cÚ¡ *
s
, 
Ën
, cÚ¡ *
£p
, 
£¶’
, *
couÁ
) {

799 
–em’ts
 = 0, 
¦Ùs
 = 5, 
¡¬t
 = 0, 
j
;

800 
sds
 *
tok’s
;

802 ià(
£¶’
 < 1 || 
Ën
 < 0è 
NULL
;

804 
tok’s
 = 
	`s_m®loc
((
sds
)*
¦Ùs
);

805 ià(
tok’s
 =ğ
NULL
)  NULL;

807 ià(
Ën
 == 0) {

808 *
couÁ
 = 0;

809  
tok’s
;

811 
j
 = 0; j < (
Ën
-(
£¶’
-1)); j++) {

813 ià(
¦Ùs
 < 
–em’ts
+2) {

814 
sds
 *
Ãwtok’s
;

816 
¦Ùs
 *= 2;

817 
Ãwtok’s
 = 
	`s_»®loc
(
tok’s
,(
sds
)*
¦Ùs
);

818 ià(
Ãwtok’s
 =ğ
NULL
è
ş—nup
;

819 
tok’s
 = 
Ãwtok’s
;

822 ià((
£¶’
 =ğ1 && *(
s
+
j
è=ğ
£p
[0]è|| (
	`memcmp
(s+j,sep,seplen) == 0)) {

823 
tok’s
[
–em’ts
] = 
	`sd¢ewËn
(
s
+
¡¬t
,
j
-start);

824 ià(
tok’s
[
–em’ts
] =ğ
NULL
è
ş—nup
;

825 
–em’ts
++;

826 
¡¬t
 = 
j
+
£¶’
;

827 
j
 = j+
£¶’
-1;

831 
tok’s
[
–em’ts
] = 
	`sd¢ewËn
(
s
+
¡¬t
,
Ën
-start);

832 ià(
tok’s
[
–em’ts
] =ğ
NULL
è
ş—nup
;

833 
–em’ts
++;

834 *
couÁ
 = 
–em’ts
;

835  
tok’s
;

837 
ş—nup
:

839 
i
;

840 
i
 = 0; i < 
–em’ts
; i++è
	`sdsä“
(
tok’s
[i]);

841 
	`s_ä“
(
tok’s
);

842 *
couÁ
 = 0;

843  
NULL
;

845 
	}
}

848 
	$sdsä“¥l™»s
(
sds
 *
tok’s
, 
couÁ
) {

849 ià(!
tok’s
) ;

850 
couÁ
--)

851 
	`sdsä“
(
tok’s
[
couÁ
]);

852 
	`s_ä“
(
tok’s
);

853 
	}
}

861 
sds
 
	$sdsÿŒ•r
(
sds
 
s
, cÚ¡ *
p
, 
size_t
 
Ën
) {

862 
s
 = 
	`sdsÿ’
(s,"\"",1);

863 
Ën
--) {

864 *
p
) {

867 
s
 = 
	`sdsÿrštf
(s,"\\%c",*
p
);

869 '\n': 
s
 = 
	`sdsÿ’
(s,"\\n",2); ;

870 '\r': 
s
 = 
	`sdsÿ’
(s,"\\r",2); ;

871 '\t': 
s
 = 
	`sdsÿ’
(s,"\\t",2); ;

872 '\a': 
s
 = 
	`sdsÿ’
(s,"\\a",2); ;

873 '\b': 
s
 = 
	`sdsÿ’
(s,"\\b",2); ;

875 ià(
	`i¥ršt
(*
p
))

876 
s
 = 
	`sdsÿrštf
(s,"%c",*
p
);

878 
s
 = 
	`sdsÿrštf
(s,"\\x%02x",()*
p
);

881 
p
++;

883  
	`sdsÿ’
(
s
,"\"",1);

884 
	}
}

888 
	$is_hex_dig™
(
c
) {

889  (
c
 >= '0' && c <= '9') || (c >= 'a' && c <= 'f') ||

890 (
c
 >= 'A' && c <= 'F');

891 
	}
}

895 
	$hex_dig™_to_št
(
c
) {

896 
c
) {

915 
	}
}

936 
sds
 *
	$sds¥l™¬gs
(cÚ¡ *
lše
, *
¬gc
) {

937 cÚ¡ *
p
 = 
lše
;

938 *
cu¼’t
 = 
NULL
;

939 **
veùÜ
 = 
NULL
;

941 *
¬gc
 = 0;

944 *
p
 && 
	`is¥aû
(*p))…++;

945 ià(*
p
) {

947 
šq
=0;

948 
šsq
=0;

949 
dÚe
=0;

951 ià(
cu¼’t
 =ğ
NULL
ècu¼’ˆğ
	`sd£m±y
();

952 !
dÚe
) {

953 ià(
šq
) {

954 ià(*
p
 == '\\' && *(p+1) == 'x' &&

955 
	`is_hex_dig™
(*(
p
+2)) &&

956 
	`is_hex_dig™
(*(
p
+3)))

958 
by‹
;

960 
by‹
 = (
	`hex_dig™_to_št
(*(
p
+2))*16)+

961 
	`hex_dig™_to_št
(*(
p
+3));

962 
cu¼’t
 = 
	`sdsÿ’
(cu¼’t,(*)&
by‹
,1);

963 
p
 += 3;

964 } ià(*
p
 == '\\' && *(p+1)) {

965 
c
;

967 
p
++;

968 *
p
) {

969 'n': 
c
 = '\n'; ;

970 'r': 
c
 = '\r'; ;

971 't': 
c
 = '\t'; ;

972 'b': 
c
 = '\b'; ;

973 'a': 
c
 = '\a'; ;

974 : 
c
 = *
p
; ;

976 
cu¼’t
 = 
	`sdsÿ’
(cu¼’t,&
c
,1);

977 } ià(*
p
 == '"') {

980 ià(*(
p
+1è&& !
	`is¥aû
(*Õ+1))è
”r
;

981 
dÚe
=1;

982 } ià(!*
p
) {

984 
”r
;

986 
cu¼’t
 = 
	`sdsÿ’
(cu¼’t,
p
,1);

988 } ià(
šsq
) {

989 ià(*
p
 == '\\' && *(p+1) == '\'') {

990 
p
++;

991 
cu¼’t
 = 
	`sdsÿ’
(current,"'",1);

992 } ià(*
p
 == '\'') {

995 ià(*(
p
+1è&& !
	`is¥aû
(*Õ+1))è
”r
;

996 
dÚe
=1;

997 } ià(!*
p
) {

999 
”r
;

1001 
cu¼’t
 = 
	`sdsÿ’
(cu¼’t,
p
,1);

1004 *
p
) {

1010 
dÚe
=1;

1013 
šq
=1;

1016 
šsq
=1;

1019 
cu¼’t
 = 
	`sdsÿ’
(cu¼’t,
p
,1);

1023 ià(*
p
)…++;

1026 
veùÜ
 = 
	`s_»®loc
(veùÜ,((*
¬gc
)+1)*(*));

1027 
veùÜ
[*
¬gc
] = 
cu¼’t
;

1028 (*
¬gc
)++;

1029 
cu¼’t
 = 
NULL
;

1032 ià(
veùÜ
 =ğ
NULL
èveùÜ = 
	`s_m®loc
((*));

1033  
veùÜ
;

1037 
”r
:

1038 (*
¬gc
)--)

1039 
	`sdsä“
(
veùÜ
[*
¬gc
]);

1040 
	`s_ä“
(
veùÜ
);

1041 ià(
cu¼’t
è
	`sdsä“
(current);

1042 *
¬gc
 = 0;

1043  
NULL
;

1044 
	}
}

1055 
sds
 
	$sdsm­ch¬s
(
sds
 
s
, cÚ¡ *
äom
, cÚ¡ *
to
, 
size_t
 
£’
) {

1056 
size_t
 
j
, 
i
, 
l
 = 
	`sd¦’
(
s
);

1058 
j
 = 0; j < 
l
; j++) {

1059 
i
 = 0; i < 
£’
; i++) {

1060 ià(
s
[
j
] =ğ
äom
[
i
]) {

1061 
s
[
j
] = 
to
[
i
];

1066  
s
;

1067 
	}
}

1071 
sds
 
	$sdsjoš
(**
¬gv
, 
¬gc
, *
£p
) {

1072 
sds
 
još
 = 
	`sd£m±y
();

1073 
j
;

1075 
j
 = 0; j < 
¬gc
; j++) {

1076 
još
 = 
	`sdsÿt
(još, 
¬gv
[
j
]);

1077 ià(
j
 !ğ
¬gc
-1è
još
 = 
	`sdsÿt
(još,
£p
);

1079  
još
;

1080 
	}
}

1083 
sds
 
	$sdsjošsds
(
sds
 *
¬gv
, 
¬gc
, cÚ¡ *
£p
, 
size_t
 
£¶’
) {

1084 
sds
 
još
 = 
	`sd£m±y
();

1085 
j
;

1087 
j
 = 0; j < 
¬gc
; j++) {

1088 
još
 = 
	`sdsÿtsds
(još, 
¬gv
[
j
]);

1089 ià(
j
 !ğ
¬gc
-1è
još
 = 
	`sdsÿ’
(još,
£p
,
£¶’
);

1091  
još
;

1092 
	}
}

1099 *
	$sds_m®loc
(
size_t
 
size
è{  
	`s_m®loc
(size); 
	}
}

1100 *
	$sds_»®loc
(*
±r
, 
size_t
 
size
è{  
	`s_»®loc
ÕŒ,size); 
	}
}

1101 
	$sds_ä“
(*
±r
è{ 
	`s_ä“
ÕŒ); 
	}
}

1103 #ià
defšed
(
SDS_TEST_MAIN
)

1104 
	~<¡dio.h
>

1106 
	~"lim™s.h
"

1108 
	#UNUSED
(
x
è()(x)

	)

1109 
	$sdsTe¡
() {

1111 
sds
 
x
 = 
	`sd¢ew
("foo"), 
y
;

1113 
	`‹¡_cÚd
("Create‡ string‡nd obtainhe†ength",

1114 
	`sd¦’
(
x
è=ğ3 && 
	`memcmp
(x,"foo\0",4) == 0)

1116 
	`sdsä“
(
x
);

1117 
x
 = 
	`sd¢ewËn
("foo",2);

1118 
	`‹¡_cÚd
("Create‡ string with specified†ength",

1119 
	`sd¦’
(
x
è=ğ2 && 
	`memcmp
(x,"fo\0",3) == 0)

1121 
x
 = 
	`sdsÿt
(x,"bar");

1122 
	`‹¡_cÚd
("Strings concatenation",

1123 
	`sd¦’
(
x
è=ğ5 && 
	`memcmp
(x,"fobar\0",6) == 0);

1125 
x
 = 
	`sdsıy
(x,"a");

1126 
	`‹¡_cÚd
("sdscpy()‡gainst‡n originally†onger string",

1127 
	`sd¦’
(
x
è=ğ1 && 
	`memcmp
(x,"a\0",2) == 0)

1129 
x
 = 
	`sdsıy
(x,"xyzxxxxxxxxxxyyyyyyyyyykkkkkkkkkk");

1130 
	`‹¡_cÚd
("sdscpy()‡gainst‡n originally shorter string",

1131 
	`sd¦’
(
x
) == 33 &&

1132 
	`memcmp
(
x
,"xyzxxxxxxxxxxyyyyyyyyyykkkkkkkkkk\0",33) == 0)

1134 
	`sdsä“
(
x
);

1135 
x
 = 
	`sdsÿrštf
(
	`sd£m±y
(),"%d",123);

1136 
	`‹¡_cÚd
("sdscatprintf() seems working inhe base case",

1137 
	`sd¦’
(
x
è=ğ3 && 
	`memcmp
(x,"123\0",4) == 0)

1139 
	`sdsä“
(
x
);

1140 
x
 = 
	`sd¢ew
("--");

1141 
x
 = 
	`sdsÿtfmt
(x, "H–lØ% WÜld %I,%I--", "Hi!", 
LLONG_MIN
,
LLONG_MAX
);

1142 
	`‹¡_cÚd
("sdscatfmt() seems working inhe base case",

1143 
	`sd¦’
(
x
) == 60 &&

1144 
	`memcmp
(
x
,"--Hello Hi! World -9223372036854775808,"

1146 
	`´štf
("[%s]\n",
x
);

1148 
	`sdsä“
(
x
);

1149 
x
 = 
	`sd¢ew
("--");

1150 
x
 = 
	`sdsÿtfmt
(x, "%u,%U--", 
UINT_MAX
, 
ULLONG_MAX
);

1151 
	`‹¡_cÚd
("sdscatfmt() seems working with unsigned‚umbers",

1152 
	`sd¦’
(
x
) == 35 &&

1153 
	`memcmp
(
x
,"--4294967295,18446744073709551615--",35) == 0)

1155 
	`sdsä“
(
x
);

1156 
x
 = 
	`sd¢ew
(" x ");

1157 
	`sd¡rim
(
x
," x");

1158 
	`‹¡_cÚd
("sdstrim() works when‡ll chars match",

1159 
	`sd¦’
(
x
) == 0)

1161 
	`sdsä“
(
x
);

1162 
x
 = 
	`sd¢ew
(" x ");

1163 
	`sd¡rim
(
x
," ");

1164 
	`‹¡_cÚd
("sdstrim() works when‡ single char„emains",

1165 
	`sd¦’
(
x
) == 1 && x[0] == 'x')

1167 
	`sdsä“
(
x
);

1168 
x
 = 
	`sd¢ew
("xxciaoyyy");

1169 
	`sd¡rim
(
x
,"xy");

1170 
	`‹¡_cÚd
("sdstrim() correctlyrims characters",

1171 
	`sd¦’
(
x
è=ğ4 && 
	`memcmp
(x,"ciao\0",5) == 0)

1173 
y
 = 
	`sdsdup
(
x
);

1174 
	`sd¤ªge
(
y
,1,1);

1175 
	`‹¡_cÚd
("sdsrange(...,1,1)",

1176 
	`sd¦’
(
y
è=ğ1 && 
	`memcmp
(y,"i\0",2) == 0)

1178 
	`sdsä“
(
y
);

1179 
y
 = 
	`sdsdup
(
x
);

1180 
	`sd¤ªge
(
y
,1,-1);

1181 
	`‹¡_cÚd
("sdsrange(...,1,-1)",

1182 
	`sd¦’
(
y
è=ğ3 && 
	`memcmp
(y,"iao\0",4) == 0)

1184 
	`sdsä“
(
y
);

1185 
y
 = 
	`sdsdup
(
x
);

1186 
	`sd¤ªge
(
y
,-2,-1);

1187 
	`‹¡_cÚd
("sdsrange(...,-2,-1)",

1188 
	`sd¦’
(
y
è=ğ2 && 
	`memcmp
(y,"ao\0",3) == 0)

1190 
	`sdsä“
(
y
);

1191 
y
 = 
	`sdsdup
(
x
);

1192 
	`sd¤ªge
(
y
,2,1);

1193 
	`‹¡_cÚd
("sdsrange(...,2,1)",

1194 
	`sd¦’
(
y
è=ğ0 && 
	`memcmp
(y,"\0",1) == 0)

1196 
	`sdsä“
(
y
);

1197 
y
 = 
	`sdsdup
(
x
);

1198 
	`sd¤ªge
(
y
,1,100);

1199 
	`‹¡_cÚd
("sdsrange(...,1,100)",

1200 
	`sd¦’
(
y
è=ğ3 && 
	`memcmp
(y,"iao\0",4) == 0)

1202 
	`sdsä“
(
y
);

1203 
y
 = 
	`sdsdup
(
x
);

1204 
	`sd¤ªge
(
y
,100,100);

1205 
	`‹¡_cÚd
("sdsrange(...,100,100)",

1206 
	`sd¦’
(
y
è=ğ0 && 
	`memcmp
(y,"\0",1) == 0)

1208 
	`sdsä“
(
y
);

1209 
	`sdsä“
(
x
);

1210 
x
 = 
	`sd¢ew
("foo");

1211 
y
 = 
	`sd¢ew
("foa");

1212 
	`‹¡_cÚd
("sdscmp(foo,fß)", 
	`sdscmp
(
x
,
y
) > 0)

1214 
	`sdsä“
(
y
);

1215 
	`sdsä“
(
x
);

1216 
x
 = 
	`sd¢ew
("bar");

1217 
y
 = 
	`sd¢ew
("bar");

1218 
	`‹¡_cÚd
("sdscmp(b¬,b¬)", 
	`sdscmp
(
x
,
y
) == 0)

1220 
	`sdsä“
(
y
);

1221 
	`sdsä“
(
x
);

1222 
x
 = 
	`sd¢ew
("aar");

1223 
y
 = 
	`sd¢ew
("bar");

1224 
	`‹¡_cÚd
("sdscmp(b¬,b¬)", 
	`sdscmp
(
x
,
y
) < 0)

1226 
	`sdsä“
(
y
);

1227 
	`sdsä“
(
x
);

1228 
x
 = 
	`sd¢ewËn
("\a\n\0foo\r",7);

1229 
y
 = 
	`sdsÿŒ•r
(
	`sd£m±y
(),
x
,
	`sd¦’
(x));

1230 
	`‹¡_cÚd
("sdscatrepr(...data...)",

1231 
	`memcmp
(
y
,"\"\\a\\n\\x00foo\\r\"",15) == 0)

1234 
Şdä“
;

1235 *
p
;

1236 
¡•
 = 10, 
j
, 
i
;

1238 
	`sdsä“
(
x
);

1239 
	`sdsä“
(
y
);

1240 
x
 = 
	`sd¢ew
("0");

1241 
	`‹¡_cÚd
("sd¢ew(èä“/ËÀbufãrs", 
	`sd¦’
(
x
è=ğ1 && 
	`sd§va
(x) == 0);

1245 
i
 = 0; i < 10; i++) {

1246 
ŞdËn
 = 
	`sd¦’
(
x
);

1247 
x
 = 
	`sdsMakeRoomFÜ
(x,
¡•
);

1248 
ty³
 = 
x
[-1]&
SDS_TYPE_MASK
;

1250 
	`‹¡_cÚd
("sdsMakeRoomFÜ(èËn", 
	`sd¦’
(
x
è=ğ
ŞdËn
);

1251 ià(
ty³
 !ğ
SDS_TYPE_5
) {

1252 
	`‹¡_cÚd
("sdsMakeRoomFÜ(èä“", 
	`sd§va
(
x
è>ğ
¡•
);

1253 
Şdä“
 = 
	`sd§va
(
x
);

1254 (è
Şdä“
;

1256 
p
 = 
x
+
ŞdËn
;

1257 
j
 = 0; j < 
¡•
; j++) {

1258 
p
[
j
] = 'A'+j;

1260 
	`sdsInüL’
(
x
,
¡•
);

1262 
	`‹¡_cÚd
("sdsMakeRoomFor() content",

1263 
	`memcmp
("0ABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJABCDEFGHIJ",
x
,101) == 0);

1264 
	`‹¡_cÚd
("sdsMakeRoomFÜ(èfš®†’gth",
	`sd¦’
(
x
)==101);

1266 
	`sdsä“
(
x
);

1269 
	`‹¡_»pÜt
()

1271 
	}
}

1274 #ifdeà
SDS_TEST_MAIN


1275 
	$maš
() {

1276  
	`sdsTe¡
();

1277 
	}
}

	@sds.h

33 #iâdeà
__SDS_H


34 
	#__SDS_H


	)

36 
	#SDS_MAX_PREALLOC
 (1024*1024)

	)

38 
	~<sys/ty³s.h
>

39 
	~<¡d¬g.h
>

40 
	~<¡dšt.h
>

42 *
	tsds
;

46 
__©Œibu‹__
 ((
__·cked__
)è
	gsdshdr5
 {

47 
	gæags
;

48 
	gbuf
[];

50 
__©Œibu‹__
 ((
__·cked__
)è
	gsdshdr8
 {

51 
ušt8_t
 
	gËn
;

52 
ušt8_t
 
	g®loc
;

53 
	gæags
;

54 
	gbuf
[];

56 
__©Œibu‹__
 ((
__·cked__
)è
	gsdshdr16
 {

57 
ušt16_t
 
	gËn
;

58 
ušt16_t
 
	g®loc
;

59 
	gæags
;

60 
	gbuf
[];

62 
__©Œibu‹__
 ((
__·cked__
)è
	gsdshdr32
 {

63 
ušt32_t
 
	gËn
;

64 
ušt32_t
 
	g®loc
;

65 
	gæags
;

66 
	gbuf
[];

68 
__©Œibu‹__
 ((
__·cked__
)è
	gsdshdr64
 {

69 
ušt64_t
 
	gËn
;

70 
ušt64_t
 
	g®loc
;

71 
	gæags
;

72 
	gbuf
[];

75 
	#SDS_TYPE_5
 0

	)

76 
	#SDS_TYPE_8
 1

	)

77 
	#SDS_TYPE_16
 2

	)

78 
	#SDS_TYPE_32
 3

	)

79 
	#SDS_TYPE_64
 4

	)

80 
	#SDS_TYPE_MASK
 7

	)

81 
	#SDS_TYPE_BITS
 3

	)

82 
	#SDS_HDR_VAR
(
T
,
s
è
sdshdr
##T *
sh
 = (*)((s)-((sdshdr##T)));

	)

83 
	#SDS_HDR
(
T
,
s
è((
sdshdr
##T *)((s)-((sdshdr##T))))

	)

84 
	#SDS_TYPE_5_LEN
(
f
è((f)>>
SDS_TYPE_BITS
)

	)

86 
šlše
 
size_t
 
	$sd¦’
(cÚ¡ 
sds
 
s
) {

87 
æags
 = 
s
[-1];

88 
æags
&
SDS_TYPE_MASK
) {

89 
SDS_TYPE_5
:

90  
	`SDS_TYPE_5_LEN
(
æags
);

91 
SDS_TYPE_8
:

92  
	`SDS_HDR
(8,
s
)->
Ën
;

93 
SDS_TYPE_16
:

94  
	`SDS_HDR
(16,
s
)->
Ën
;

95 
SDS_TYPE_32
:

96  
	`SDS_HDR
(32,
s
)->
Ën
;

97 
SDS_TYPE_64
:

98  
	`SDS_HDR
(64,
s
)->
Ën
;

101 
	}
}

103 
šlše
 
size_t
 
	$sd§va
(cÚ¡ 
sds
 
s
) {

104 
æags
 = 
s
[-1];

105 
æags
&
SDS_TYPE_MASK
) {

106 
SDS_TYPE_5
: {

109 
SDS_TYPE_8
: {

110 
	`SDS_HDR_VAR
(8,
s
);

111  
sh
->
®loc
 - sh->
Ën
;

113 
SDS_TYPE_16
: {

114 
	`SDS_HDR_VAR
(16,
s
);

115  
sh
->
®loc
 - sh->
Ën
;

117 
SDS_TYPE_32
: {

118 
	`SDS_HDR_VAR
(32,
s
);

119  
sh
->
®loc
 - sh->
Ën
;

121 
SDS_TYPE_64
: {

122 
	`SDS_HDR_VAR
(64,
s
);

123  
sh
->
®loc
 - sh->
Ën
;

127 
	}
}

129 
šlše
 
	$sds£’
(
sds
 
s
, 
size_t
 
ÃwËn
) {

130 
æags
 = 
s
[-1];

131 
æags
&
SDS_TYPE_MASK
) {

132 
SDS_TYPE_5
:

134 *
å
 = ((*)
s
)-1;

135 *
å
 = 
SDS_TYPE_5
 | (
ÃwËn
 << 
SDS_TYPE_BITS
);

138 
SDS_TYPE_8
:

139 
	`SDS_HDR
(8,
s
)->
Ën
 = 
ÃwËn
;

141 
SDS_TYPE_16
:

142 
	`SDS_HDR
(16,
s
)->
Ën
 = 
ÃwËn
;

144 
SDS_TYPE_32
:

145 
	`SDS_HDR
(32,
s
)->
Ën
 = 
ÃwËn
;

147 
SDS_TYPE_64
:

148 
	`SDS_HDR
(64,
s
)->
Ën
 = 
ÃwËn
;

151 
	}
}

153 
šlše
 
	$sdsšş’
(
sds
 
s
, 
size_t
 
šc
) {

154 
æags
 = 
s
[-1];

155 
æags
&
SDS_TYPE_MASK
) {

156 
SDS_TYPE_5
:

158 *
å
 = ((*)
s
)-1;

159 
ÃwËn
 = 
	`SDS_TYPE_5_LEN
(
æags
)+
šc
;

160 *
å
 = 
SDS_TYPE_5
 | (
ÃwËn
 << 
SDS_TYPE_BITS
);

163 
SDS_TYPE_8
:

164 
	`SDS_HDR
(8,
s
)->
Ën
 +ğ
šc
;

166 
SDS_TYPE_16
:

167 
	`SDS_HDR
(16,
s
)->
Ën
 +ğ
šc
;

169 
SDS_TYPE_32
:

170 
	`SDS_HDR
(32,
s
)->
Ën
 +ğ
šc
;

172 
SDS_TYPE_64
:

173 
	`SDS_HDR
(64,
s
)->
Ën
 +ğ
šc
;

176 
	}
}

179 
šlše
 
size_t
 
	$sd§Îoc
(cÚ¡ 
sds
 
s
) {

180 
æags
 = 
s
[-1];

181 
æags
&
SDS_TYPE_MASK
) {

182 
SDS_TYPE_5
:

183  
	`SDS_TYPE_5_LEN
(
æags
);

184 
SDS_TYPE_8
:

185  
	`SDS_HDR
(8,
s
)->
®loc
;

186 
SDS_TYPE_16
:

187  
	`SDS_HDR
(16,
s
)->
®loc
;

188 
SDS_TYPE_32
:

189  
	`SDS_HDR
(32,
s
)->
®loc
;

190 
SDS_TYPE_64
:

191  
	`SDS_HDR
(64,
s
)->
®loc
;

194 
	}
}

196 
šlše
 
	$sds£Îoc
(
sds
 
s
, 
size_t
 
ÃwËn
) {

197 
æags
 = 
s
[-1];

198 
æags
&
SDS_TYPE_MASK
) {

199 
SDS_TYPE_5
:

202 
SDS_TYPE_8
:

203 
	`SDS_HDR
(8,
s
)->
®loc
 = 
ÃwËn
;

205 
SDS_TYPE_16
:

206 
	`SDS_HDR
(16,
s
)->
®loc
 = 
ÃwËn
;

208 
SDS_TYPE_32
:

209 
	`SDS_HDR
(32,
s
)->
®loc
 = 
ÃwËn
;

211 
SDS_TYPE_64
:

212 
	`SDS_HDR
(64,
s
)->
®loc
 = 
ÃwËn
;

215 
	}
}

217 
sds
 
sd¢ewËn
(cÚ¡ *
š™
, 
size_t
 
š™Ën
);

218 
sds
 
sd¢ew
(cÚ¡ *
š™
);

219 
sds
 
sd£m±y
();

220 
sds
 
sdsdup
(cÚ¡ sd 
s
);

221 
sdsä“
(
sds
 
s
);

222 
sds
 
sdsgrowz”o
(sd 
s
, 
size_t
 
Ën
);

223 
sds
 
sdsÿ’
(sd 
s
, cÚ¡ *
t
, 
size_t
 
Ën
);

224 
sds
 
sdsÿt
(sd 
s
, cÚ¡ *
t
);

225 
sds
 
sdsÿtsds
(sd 
s
, cÚ¡ sd 
t
);

226 
sds
 
sdsıyËn
(sd 
s
, cÚ¡ *
t
, 
size_t
 
Ën
);

227 
sds
 
sdsıy
(sd 
s
, cÚ¡ *
t
);

229 
sds
 
sdsÿtv´štf
(sd 
s
, cÚ¡ *
fmt
, 
va_li¡
 
­
);

230 #ifdeà
__GNUC__


231 
sds
 
	$sdsÿrštf
(
sds
 
s
, cÚ¡ *
fmt
, ...)

232 
	`__©Œibu‹__
((
	`fÜm©
(
´štf
, 2, 3)));

234 
sds
 
	`sdsÿrštf
(sd 
s
, cÚ¡ *
fmt
, ...);

237 
sds
 
	`sdsÿtfmt
(sd 
s
, cÚ¡ *
fmt
, ...);

238 
sds
 
	`sd¡rim
(sd 
s
, cÚ¡ *
c£t
);

239 
	`sd¤ªge
(
sds
 
s
, 
¡¬t
, 
’d
);

240 
	`sdsupd©–’
(
sds
 
s
);

241 
	`sdsş—r
(
sds
 
s
);

242 
	`sdscmp
(cÚ¡ 
sds
 
s1
, cÚ¡ sd 
s2
);

243 
sds
 *
	`sds¥l™Ën
(cÚ¡ *
s
, 
Ën
, cÚ¡ *
£p
, 
£¶’
, *
couÁ
);

244 
	`sdsä“¥l™»s
(
sds
 *
tok’s
, 
couÁ
);

245 
	`sd¡Şow”
(
sds
 
s
);

246 
	`sd¡ouµ”
(
sds
 
s
);

247 
sds
 
	`sdsäomlÚglÚg
(
v®ue
);

248 
sds
 
	`sdsÿŒ•r
(sd 
s
, cÚ¡ *
p
, 
size_t
 
Ën
);

249 
sds
 *
	`sds¥l™¬gs
(cÚ¡ *
lše
, *
¬gc
);

250 
sds
 
	`sdsm­ch¬s
(sd 
s
, cÚ¡ *
äom
, cÚ¡ *
to
, 
size_t
 
£’
);

251 
sds
 
	`sdsjoš
(**
¬gv
, 
¬gc
, *
£p
);

252 
sds
 
	`sdsjošsds
(sd *
¬gv
, 
¬gc
, cÚ¡ *
£p
, 
size_t
 
£¶’
);

255 
sds
 
	`sdsMakeRoomFÜ
(sd 
s
, 
size_t
 
addËn
);

256 
	`sdsInüL’
(
sds
 
s
, 
šü
);

257 
sds
 
	`sdsRemoveF»eS·û
(sd 
s
);

258 
size_t
 
	`sdsAÎocSize
(
sds
 
s
);

259 *
	`sdsAÎocPŒ
(
sds
 
s
);

265 *
	`sds_m®loc
(
size_t
 
size
);

266 *
	`sds_»®loc
(*
±r
, 
size_t
 
size
);

267 
	`sds_ä“
(*
±r
);

269 #ifdeà
REDIS_TEST


270 
	`sdsTe¡
(
¬gc
, *
¬gv
[]);

273 
	#s_m®loc
 
m®loc


	)

274 
	#s_»®loc
 
»®loc


	)

275 
	#s_ä“
 
ä“


	)

278 
__çed_‹¡s
 = 0;

279 
__‹¡_num
 = 0;

280 
	#‹¡_cÚd
(
desü
,
_c
) do { \

281 
__‹¡_num
++; 
	`´štf
("%d - %s: ", __‹¡_num, 
desü
); \

282 if(
_c
è
	`´štf
("PASSED\n"); {´štf("FAILED\n"); 
__çed_‹¡s
++;} \

283 
	}
} 0);

	)

284 
	#‹¡_»pÜt
() do { \

285 
	`´štf
("%de¡s, %d…as£d, %d faed\n", 
__‹¡_num
, \

286 
__‹¡_num
-
__çed_‹¡s
, __failed_tests); \

287 ià(
__çed_‹¡s
) { \

288 
	`´štf
("=== WARNING === We have failedests here...\n"); \

289 
	`ex™
(1); \

291 } 0);

	)

	@
1
.
0
2
12
sds.c
sds.h
